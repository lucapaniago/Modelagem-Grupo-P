
tspan = 0:0.001:10;

q_0 = [1 0 0 0 0 0 0];
ops = odeset('MaxStep', 1e-5);
[t1,q1] = ode45(@f, tspan, q_0, ops); 

figure(1)
plot(t1,q1(:,1))
hold on
plot(t1,q1(:,2))
hold on
plot(t1,q1(:,3))
hold on
plot(t1,q1(:,4))
legend("q_0","q_1","q_2","q_3")
xlabel("tempo (s)")
ylabel("quaternions")

figure(2)
plot(t1,q1(:,5))
hold on
plot(t1,q1(:,6))
hold on
plot(t1,q1(:,7))
legend("w_x","w_y","w_z")
xlabel("tempo (s)")
ylabel("Velocidade Ã¢ngular (rad/s)")

function dy = f(t,q)
    T_x = 0;
    T_y = 0;
    T_z = 0;
    dy_1 = 1/2*(-q(2)*q(5) - q(3)*q(6) - q(4)*q(7));
    dy_2 = 1/2*(q(1)*q(5) - q(4)*q(6) + q(3)*q(7));
    dy_3 = 1/2*(q(4)*q(5) + q(1)*q(6) - q(2)*q(7));
    dy_4 = 1/2*(-q(3)*q(5) + q(2)*q(6) + q(1)*q(7));
    dy_5 = 4875.31*(-0.00801894*q(1)^2 + 0.0160379*q(1)*q(2) + 0.00801894*q(2)^2 + 0.00801894*q(3)^2 + 0.0160379*q(3)*q(4) - 0.00801894*q(4)^2 + 0.027945*T_x + 0.012375*T_y + 0.012375*T_z) - 0.00102745*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2*q(6) + 0.234842*q(6)^2 + q(5)*(-0.00175975*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2 + 0.234842*q(6) - 0.234842*q(7)) - 0.00102745*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2*q(7) - 0.234842*q(7)^2;
    dy_6 = 4875.31*(0.00801894*q(1)^2 - 0.00801894*q(2)^2 + 0.0160379*q(1)*q(3) - 0.00801894*q(3)^2 - 0.0160379*q(2)*q(4) + 0.00801894*q(4)^2 + 0.012375*T_x + 0.027945*T_y + 0.012375*T_z) - 0.234842*q(5)^2 + q(5)*(-0.00102745*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2 - 0.234842*q(6)) + q(6)*(-0.00175975*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2 + 0.234842*q(7)) - 0.00102745*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2*q(7) + 0.234842*q(7)^2;
    dy_7 = 2437.65*(-0.0320758*q(1)*(q(2) + q(3)) + 0.0320758*q(2)*q(4) + 0.3*(-0.106919*q(3)*q(4) + 0.0825*(T_x + T_y)) + 0.04239*T_z) + 0.234842*q(5)^2 - 0.234842*q(6)^2 + q(6)*(-0.00102745*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2 - 0.234842*q(7)) + q(5)*(-0.00102745*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2 + 0.234842*q(7)) - 0.00175975*(q(1)^2 + q(2)^2 + q(3)^2 + q(4)^2)^2*q(7);
    dy = [dy_1;dy_2;dy_3;dy_4;dy_5;dy_6;dy_7];
end